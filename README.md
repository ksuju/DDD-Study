## Chapter 1. 도메인 모델 시작하기

**도메인이란? 소프트웨어로 해결하고자 하는 문제 영역**

### **도메인의 핵심 개념과 의도**

1\. 도메인 모델은 소프트웨어가 해결하고자 하는 비즈니스 영역의 중요한 개념과 규칙(= 비즈니스 로직)을 코드로 표현한 것

2\. 실제 비즈니스 동작과 요구사항을 정확하게 반영하고,

도메인 전문가와 개발자가 공통의 언어와 이해를 가질 수 있도록 설계되어야 함

3\. 즉, **도메인의 핵심 개념과 의도란 "해결해야 할 비즈니스의 본질적 규칙과 의미"를 코드에 정확히 담는 것**을 의미함!!

### **개념 모델과 구현 모델**

\- 개념모델? 순수하게 문제를 분석한 결과물. DB, 트랜잭션 처리, 성능, 구현 기술과 같은 것을 고려 X

\- 처음부터 완벽하게 만들 필요 X, 불가능 하기도 함. 보통 개발하면서 도메인에 대한 지식과 이해가 쌓이면서 점진적으로 개념 모델을 구현 모델로 발전시켜 나간다.

### **DDD에서의 엔티티와 밸류**

#### **1\. 엔티티**

\- 가장 큰 특징은 식별자를 가진다는 것

\- 식별자는 다양한 방법으로 생성함 (일련번호 사용, UUID, 직접 값 입력 등)

#### **2\. 밸류**

\- 개념적으로 완전한 하나를 표현할 때 사용함

\- 도메인에서 특별한 의미를 지닌다.

\- 주로 엔티티의 속성이나 여러 데이터의 조합으로 사용된다.

ex) 01012345678로 전화번호를 입력했을 때 이를 010-1234-5678로 만들어주는 클래스가 VO의 예시 중 하나.

\-> **특정 값을 도메인에서 중요한 의미를 가지는 값으로 격상시켜주는 클래스**!

```
public class PhoneNumber {
    private final String value;

    public PhoneNumber(String raw) {
        // 검증 메서드 호출
        this.value = formatAndValidate(raw);
    }

    // 검증 + 포맷팅 메서드
    private String formatAndValidate(String raw) {
        String digits = raw.replaceAll("\\D", "");
        if (digits.length() != 11) {
            throw new IllegalArgumentException("휴대폰 번호는 11자리여야 합니다.");
        }
        return digits.replaceFirst("(\\d{3})(\\d{4})(\\d{4})", "$1-$2-$3");
    }

    public String getValue() {
        return value;
    }
}
```

\> 위 코드가 VO 클래스의 전형적인 예시라고 볼 수 있다.

\> 11자리의 숫자를 중요한 의미를 가지는 값(전화번호)으로 격상 시켜줌

### **도메인 모델에 set 메서드 넣지 않기!**

\- **도메인 get/set 메서드를 무조건 넣는 것은 좋지 않은 버릇임**

\- 특히 set 메서드는 도메인의 핵심 개념이나 의도를 심각하게 저해한다!

\> 단순히 값을 바꾸는 기능만 제공하는 set 메서드는 **"왜" 값이 바뀌고 어떤 규칙이 적용되는지 코드에 드러나지 않음!**

\> set 메서드를 사용하면 **필수 값이 빠진 상태로 객체가 생성**될 수 있어 도메인 규칙이 깨질 수 있음

\> 외부에서 아무때나 set 메서드를 통해 값을 바꿀 수 있으니 **일관성이 떨어지게됨**

\* DTO는 도메인 로직을 담고 있지는 않기 때문에, get/set 메서드를 사용해도 도메인 객체의 데이터 일관성에 영향을 줄 가능성이 높지 않다!

\* 프레임워크가 DTO 필드에 직접 값을 할당하는 기능을 제공한다면, set 메서드 대신 이를 적극적으로 활용하자. ( = Lombok의 @Setter)

### 도메인 용어와 유비쿼터스 언어

\- 코드를 작성할 때 도메인에서 사용하는 용어는 매우 중요함

\- 실제 주문 상태는 '결제 대기', '상품 준비', '출고 완료', '배송 중', '배송 완료', '주문 취소'인데 아래와 같이 코드를 작성하면 해당 코드가 어떤 상태를 표현하는지 알아햐 하는 번거로움이 생긴다. 따라서, 'PAYMENT\_WAITING', 'SHIPPED' 처럼 도메인 용어를 사용해서 OrderState를 구현하면 불필요한 변환 과정을 거치지 않아도 된다.

```
public OriderState {
	STEP1, STEP2, STEP3, STEP4, STEP5, STEP6
}
```

\- 유비쿼터스 언어란? 문서, 도메인 모델, 코드, 테스트 등 모든 곳에서 관련 직군의 사람들이 같은 용어를 사용함으로써 소통 과정에서 발생하는 오류를 줄이는 것에 대한 중요성을 표현하기 위한 용어이다.

\> DDD에서 언어의 중요함을 강조하기 위해 만든 용어!!
